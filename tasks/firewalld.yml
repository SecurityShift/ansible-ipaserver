---
- name: Enable the LDAPS firewalld ruleset provided by freeipa
  firewalld: service=freeipa-ldaps permanent=true state=enabled
  notify: reload firewalld
  when: ansible_distribution == "Fedora"

- name: Enable the individual rulesets for CentOS
  firewalld:
    service: '{{ item.service | default(omit) }}'
    port: '{{ item.port | default(omit) }}'
    permanent: true
    state: enabled
  with_items:
    - service: http
    - service: https
    - service: ldap
    - service: ldaps
    - service: kerberos
    - service: kpasswd
    - service: dns
    - service: ntp
    - port: 8443/tcp
  notify: reload firewalld
  when: ansible_distribution != "Fedora" and ansible_os_family == "RedHat"

- name: Reload firewall
  meta: flush_handlers
